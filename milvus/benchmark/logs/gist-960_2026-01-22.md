# GIST-960 DiskANN 性能测试报告

**测试时间**: 2026-01-22 21:35

---

## 测试环境

### 硬件配置

| 项目 | 配置 |
|------|------|
| **设备** | MacBook Pro |
| **芯片** | Apple M4 Pro |
| **CPU 核心** | 14核 (10 性能核 + 4 能效核) |
| **内存** | 24 GB |
| **架构** | ARM64 (Apple Silicon) |

### 软件环境

| 项目 | 版本 |
|------|------|
| **操作系统** | macOS 15.6 (Build 24G84) |
| **内核** | Darwin 24.6.0 |
| **Python 环境** | milvus-lite (conda) |
| **Milvus 版本** | 2.6.8 |
| **Milvus 模式** | Standalone (Docker) |
| **连接地址** | http://localhost:19530 |

---

## 数据集信息

| 属性 | 值 |
|------|-----|
| **数据集** | GIST-960 (gist-960-euclidean.hdf5) |
| **来源** | [ann-benchmarks.com](https://ann-benchmarks.com/) |
| **向量数量** | 1,000,000 (100万) |
| **向量维度** | 960 |
| **查询向量** | 1,000 |
| **距离类型** | L2 (欧氏距离) |
| **数据大小** | 3,662.1 MB (~3.6 GB) |
| **Ground Truth** | 1,000 × 100 |

---

## 测试配置

| 参数 | 值 |
|------|-----|
| **索引类型** | DiskANN |
| **批量大小** | 9,320 (自动调整，原50000因高维度调整) |
| **Top-K** | 100 |
| **search_list** | 150 (默认) |
| **预热查询** | 10 次 |
| **测试查询** | 1,000 次 |

---

## 测试结果

### 整体性能

| 指标 | 结果 |
|------|------|
| **插入耗时** | 140.9s (2.3 min) |
| **插入速率** | 7,097 vec/s |
| **索引构建耗时** | 527.3s (8.8 min) |
| **QPS** | 5.41 queries/sec |
| **平均延迟** | 185.01 ms |
| **Recall@100** | 0.9995 (99.95%) |

### search_list 参数对比

| search_list | QPS | Recall@100 |
|-------------|-----|------------|
| 100 | 9.66 | 99.92% |
| 150 | 6.25 | 99.97% |
| 200 | 5.13 | 99.97% |
| 300 | 3.16 | 99.98% |

---

## 结果分析

### 1. 高维度影响

GIST-960 数据集的 **960 维度**相比 SIFT-128 的 128 维度高出 7.5 倍，这导致：

- **批量大小受限**: 由于 gRPC 64MB 消息限制，批量大小从默认的 50,000 自动调整为 9,320
- **内存占用更高**: 单个向量占用 960 × 4 = 3,840 bytes，100万向量需要 ~3.6 GB
- **索引构建更慢**: 高维度导致 DiskANN 图构建更复杂

### 2. 召回率表现

- **Recall@100 达到 99.95%**，表现极佳
- 即使 search_list=100 时也能达到 99.92%，说明 DiskANN 在高维场景表现稳定
- 增加 search_list 对召回率提升有限（从 99.92% 到 99.98%），但对 QPS 影响显著

### 3. 性能-精度权衡

```
search_list ↑  =>  Recall ↑ (略微)  =>  QPS ↓ (显著)
```

| search_list | QPS 相对变化 | Recall 相对变化 |
|-------------|-------------|-----------------|
| 100 → 150 | -35.3% | +0.05% |
| 150 → 200 | -17.9% | 0% |
| 200 → 300 | -38.4% | +0.01% |

**建议**: 对于 GIST-960，**search_list=100** 是最佳性价比选择，可获得 9.66 QPS 和 99.92% 召回率。

### 4. 与 SIFT-128 对比预估

| 指标 | GIST-960 | SIFT-128 (预估) |
|------|----------|-----------------|
| 维度 | 960 | 128 |
| 内存占用 | 3.6 GB | 0.5 GB |
| 索引构建 | 8.8 min | ~2-3 min |
| QPS | 5.41 | ~30-50 |
| Recall@100 | 99.95% | ~99.9% |

### 5. 硬件资源利用

- **M4 Pro 芯片**的高性能核心有效加速了索引构建
- **24 GB 内存**足够容纳整个 GIST-960 数据集
- DiskANN 作为磁盘索引，在 Apple Silicon 的高速 SSD 上表现良好

---

## 总结

✅ **优势**:
- 99.95% 的超高召回率
- DiskANN 在高维数据上表现稳定
- 自动批量大小调整避免了 gRPC 限制问题

⚠️ **注意**:
- 高维度导致 QPS 较低（约 5-10 qps）
- 索引构建时间较长（8.8 分钟）
- 对于实时性要求高的场景，建议考虑降维或使用 GPU 加速

---

## 原始输出

<details>
<summary>点击展开完整终端输出</summary>

```
📂 正在读取 HDF5 数据集: gist-960-euclidean.hdf5
   底库向量: (1000000, 960) (3662.1 MB)
   查询向量: (1000, 960)
   Ground Truth: (1000, 100)
⚠️  维度 960 过高，调整批量大小: 50000 -> 9320

======================================================================
🚀 DiskANN 性能测试
======================================================================
   数据集: gist
   向量数: 1,000,000
   维度: 960
   距离类型: L2
   批量大小: 9,320
======================================================================

🔌 连接 Milvus...
   ✅ 已连接: http://localhost:19530
   📦 服务器版本: 2.6.8

⚠️  删除已存在的集合: gist_benchmark

📦 创建集合: gist_benchmark
   ✅ 集合创建成功 (DiskANN, L2)

======================================================================
🚀 开始插入数据 (1,000,000 条)...
======================================================================
   进度:    1,000,000 / 1,000,000 (100.0%) | 7,097 vec/s | ETA: 0.0 min
✅ 插入完成! 耗时: 140.9s (2.3 min)

======================================================================
🔨 正在构建 DiskANN 索引...
======================================================================
   索引进度: 996,696 / 1,000,000 (99.7%)
✅ 索引完成! 耗时: 527.3s (8.8 min)

📥 加载集合...
   ✅ 加载完成

======================================================================
⚡ 性能测试
======================================================================
   🔥 预热...
   🔍 执行搜索...

======================================================================
📊 测试结果
======================================================================
   数据集                  gist
   向量数                  1,000,000
   维度                   960
   QPS                  5.41 queries/sec
   平均延迟                 185.01 ms
   Recall@100           0.9995 (99.95%)
----------------------------------------------------------------------
   插入耗时                 2.3 min
   索引耗时                 8.8 min
======================================================================

📈 search_list 参数对比:
--------------------------------------------------
search_list     QPS             Recall@100     
--------------------------------------------------
100             9.66            0.9992         
150             6.25            0.9997         
200             5.13            0.9997         
300             3.16            0.9998         
--------------------------------------------------

🧹 清理...
✅ 测试完成!
```

</details>
